<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>RPG é»æ“Šç§»å‹•è§’è‰²</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
      /* éŠæˆ²å€åŸŸ */
      .game-container {
        position: relative;
        width: 400px;
        height: 400px;
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        grid-template-rows: repeat(5, 1fr);
        border: 3px solid black;
        padding: 0;
        margin: 0;
        gap: 0; /* ğŸ”¹ ç§»é™¤æ ¼å­é–“éš™ */
      }

      /* æ¯å€‹æ ¼å­ */
      .tile {
        width: 100%;
        height: 100%;
        background-color: #ddd;
        border: 1px solid #bbb;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        padding: 0;
        margin: 0;
      }

      /* è§’è‰² */
      .character {
        position: absolute;
        width: 80px; /* èˆ‡ tile ç›¸åŒ */
        height: 80px; /* èˆ‡ tile ç›¸åŒ */
        background-color: red;
        border-radius: 50%;
        transition: 0.3s ease-in-out;
      }
    </style>
  </head>
  <body>
    <div class="game-container">
      <!-- è‡ªå‹•ç”Ÿæˆ 5x5 æ ¼å­ -->
    </div>

    <body>
<script>
  $(document).ready(function () {
    let gameContainer = $(".game-container");
    let gridSize = 5; // 5x5 æ ¼å­
    let containerSize = 100; // ç™¾åˆ†æ¯”æ¨¡å¼ï¼ˆ0% ~ 100%ï¼‰

    // ç”¢ç”Ÿ 5x5 çš„æ ¼å­
    for (let i = 0; i < gridSize * gridSize; i++) {
        gameContainer.append('<div class="tile" data-index="' + i + '"></div>');
    }

    // æ·»åŠ è§’è‰²
    let character = $('<div class="character"></div>');
    gameContainer.append(character);

    let charPos = { x: 0, y: 0 }; // è§’è‰²ç•¶å‰çš„æ ¼å­ä½ç½®
    let moving = false;

    function moveCharacter(targetX, targetY) {
        if (moving) return;
        moving = true;

        let currentX = charPos.x;
        let currentY = charPos.y;
        let stepsX = [];
        let stepsY = [];

        // **è¨ˆç®— X è»¸æ­¥é©Ÿ**
        while (currentX !== targetX) {
            currentX += currentX < targetX ? 1 : -1;
            stepsX.push({ x: currentX, y: charPos.y });
        }

        // **è¨ˆç®— Y è»¸æ­¥é©Ÿ**
        while (currentY !== targetY) {
            currentY += currentY < targetY ? 1 : -1;
            stepsY.push({ x: targetX, y: currentY });
        }

        // **ç§»å‹•è§’è‰²**
        function stepMove(steps, nextStep) {
            if (steps.length === 0) {
                nextStep();
                return;
            }

            let step = steps.shift();
            let newX = (step.x / (gridSize - 1)) * containerSize; // âœ… è¨ˆç®—ç™¾åˆ†æ¯”
            let newY = (step.y / (gridSize - 1)) * containerSize; // âœ… è¨ˆç®—ç™¾åˆ†æ¯”

            character.animate(
                {
                    left: newX + "%",
                    top: newY + "%",
                },
                200,
                function () {
                    stepMove(steps, nextStep);
                }
            );

            charPos.x = step.x;
            charPos.y = step.y;
        }

        // **å…ˆç§»å‹• X è»¸ï¼Œå»¶é² 300ms å†ç§»å‹• Y è»¸**
        stepMove(stepsX, function () {
            setTimeout(function () {
                stepMove(stepsY, function () {
                    // **æœ€å¾Œæ‰‹å‹•å°é½Šåˆ°æ ¼å­**
                    let finalX = (targetX / (gridSize - 1)) * containerSize;
                    let finalY = (targetY / (gridSize - 1)) * containerSize;
                    character.css({ left: finalX + "%", top: finalY + "%" });

                    moving = false;
                });
            }, 300);
        });
    }

    // **ç›£è½æ ¼å­é»æ“Šäº‹ä»¶**
    $(".tile").on("click", function () {
        let index = $(this).data("index");
        let targetX = index % gridSize;
        let targetY = Math.floor(index / gridSize);
        moveCharacter(targetX, targetY);
    });

    // **åˆå§‹åŒ–è§’è‰²ä½ç½®**
    function setInitialPosition() {
        let startX = (charPos.x / (gridSize - 1)) * containerSize;
        let startY = (charPos.y / (gridSize - 1)) * containerSize;
        character.css({ left: startX + "%", top: startY + "%" });
    }

    setInitialPosition();
});


</script>
  </body>
</html>
